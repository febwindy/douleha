<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douleha.www.persistence.mybatis.mapper.IAuthorityMapper">

    <resultMap id="roleMap" type="role">
        <id column="roleid" property="roleId"/>
        <result column="rolename" property="roleName"/>
        <result column="role_disabled" property="disabled" typeHandler="org.apache.ibatis.type.EnumOrdinalTypeHandler"/>
    </resultMap>

    <resultMap id="authorityMap" type="Authority">
        <result column="authorityid" property="authorityId"/>
        <result column="authorityname" property="authorityName"/>
        <result column="authority_disabled" property="disabled" typeHandler="org.apache.ibatis.type.EnumOrdinalTypeHandler"/>
        <association column="menuid" property="menu" javaType="Menu">
            <result column="menuid" property="menuId"/>
            <result column="menuname" property="menuName"/>
            <result column="menuurl" property="menuUrl"/>
        </association>
        <collection property="roles" resultMap="roleMap"/>
    </resultMap>
    <select id="findAll" resultMap="authorityMap">
        SELECT
            b.authorityid,
            b.authorityname,
            b.disabled AS authority_disabled,
            m.menuid,
            m.menuname,
            m.menuurl,
            r.roleid,
            r.rolename,
            r.disabled AS role_disabled
        FROM
            douleha_authority b
        LEFT JOIN douleha_menu m ON b.authorityid = m.menuid
        LEFT JOIN douleha_role r ON b.authorityid = r.roleid
    </select>

</mapper>