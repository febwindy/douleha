<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douleha.www.persistence.mybatis.mapper.IAuthorityMapper">

    <resultMap id="roleMap" type="role">
        <id column="role_id" property="roleId"/>
        <result column="role_name" property="roleName"/>
        <result column="role_disabled" property="disabled" typeHandler="EnumOrdinalTypeHandler"/>
    </resultMap>

    <resultMap id="authorityMap" type="Authority">
        <result column="authority_id" property="authorityId"/>
        <result column="authority_name" property="authorityName"/>
        <result column="authority_disabled" property="disabled" typeHandler="EnumOrdinalTypeHandler"/>
        <association column="menu_id" property="menu" javaType="Menu">
            <result column="menu_id" property="menuId"/>
            <result column="menu_name" property="menuName"/>
            <result column="menu_url" property="menuUrl"/>
        </association>
        <collection property="roles" resultMap="roleMap"/>
    </resultMap>
    <select id="findAll" resultMap="authorityMap">
        SELECT
            b.authority_id,
            b.authority_name,
            b.disabled AS authority_disabled,
            m.menu_id,
            m.menu_name,
            m.menu_url,
            r.role_id,
            r.role_name,
            r.disabled AS role_disabled
        FROM
            douleha_authority b
        LEFT JOIN douleha_menu m ON b.authority_id = m.menu_id
        LEFT JOIN douleha_role r ON b.authority_id = r.role_id
    </select>

</mapper>